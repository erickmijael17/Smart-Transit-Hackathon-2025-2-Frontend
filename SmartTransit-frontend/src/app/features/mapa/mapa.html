<!-- Contenedor del mapa -->
<div class="map-container">
  <!-- Estado de carga -->
  @if (loading()) {
    <div class="map-loading">
      <div class="spinner"></div>
      <p>Cargando rutas...</p>
    </div>
  }

  <!-- Estado de error -->
  @if (error()) {
    <div class="map-error">
      <div class="error-icon">⚠️</div>
      <p>{{ error() }}</p>
      <small>Verifica que el backend esté corriendo en http://localhost:8080</small>
    </div>
  }

  <!-- Mapa de Leaflet -->
  <div id="map" class="leaflet-map"></div>

 

  <!-- Botón flotante para Snap to Road -->
  @if (isTrackingUserLocation()) {
    <button
      class="snap-road-toggle"
      (click)="toggleSnapToRoad()"
      [class.active]="enableSnapToRoad()"
      [class.snapping]="isSnapping()"
      [title]="enableSnapToRoad() ? 'Snap to Road: ACTIVADO' : 'Snap to Road: DESACTIVADO'">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M3 12h3m3-9v3m3 3h3m-9 3h3m3 3h3m-9 3h3"/>
        <circle cx="12" cy="12" r="3" [attr.fill]="enableSnapToRoad() ? 'currentColor' : 'none'"/>
      </svg>
      @if (isSnapping()) {
        <span class="snap-badge">...</span>
      }
    </button>
  }

  <!-- Botón flotante para panel de sugerencia de rutas -->
  <button 
    class="route-suggestion-toggle" 
    (click)="toggleRouteSuggestionPanel()" 
    [class.active]="showRouteSuggestionPanel()"
    title="Buscar ruta">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="10" r="3"/>
      <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/>
    </svg>
    <span class="button-label">¿A dónde vas?</span>
  </button>

  <!-- Overlay y Panel lateral de sugerencia de rutas -->
  @if (showRouteSuggestionPanel()) {
    <!-- Overlay oscuro (click para cerrar) -->
    <div class="panel-overlay" (click)="toggleRouteSuggestionPanel()"></div>
    
    <!-- Panel lateral -->
    <div class="side-panel route-suggestion-side-panel">
      <app-route-suggestion (showRouteOnMap)="onShowRouteOnMap($event)"></app-route-suggestion>
    </div>
  }

</div>
