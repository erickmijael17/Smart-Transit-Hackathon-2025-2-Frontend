<div class="route-list-container">
  <!-- Header con t√≠tulo y contador -->
  <div class="route-list-header">
    <div class="header-title">
      <h2>L√≠neas de Transporte</h2>
      <div class="header-meta">
        <span class="route-count">{{ filteredRoutes().length }} l√≠neas</span>
        @if (isTrackingConnected()) {
          <span class="tracking-status connected">
            <span class="status-dot"></span>
            {{ activeBusCount() }} buses activos
          </span>
        }
      </div>
    </div>
    
    @if (selectedCount() > 0) {
      <button class="clear-btn" (click)="clearAllSelections()">
        Limpiar selecci√≥n
      </button>
    }
  </div>

  <!-- Barra de b√∫squeda -->
  <div class="search-bar">
    <div class="search-input-wrapper">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        class="search-input"
        placeholder="Buscar l√≠nea..."
        [value]="searchQuery()"
        (input)="onSearchChange($event)"
      />
      @if (searchQuery()) {
        <button class="clear-search-btn" (click)="clearSearch()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      }
    </div>
  </div>

  <!-- Acciones r√°pidas -->
  <div class="quick-actions">
    <button class="action-btn" (click)="showAllRoutes()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
      Mostrar todas
    </button>
    <button class="action-btn" (click)="hideAllRoutes()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
        <line x1="1" y1="1" x2="23" y2="23"></line>
      </svg>
      Ocultar todas
    </button>
  </div>

  <!-- Lista de rutas -->
  <div class="route-list">
    @if (filteredRoutes().length === 0 && !loading) {
      <div class="empty-state">
        <div class="empty-icon">üîç</div>
        <p>No se encontraron l√≠neas</p>
        @if (searchQuery()) {
          <small>Intenta con otro t√©rmino de b√∫squeda</small>
        } @else {
          <small>No hay l√≠neas disponibles en el sistema</small>
        }
      </div>
    }

    @for (route of filteredRoutes(); track route.id) {
      <div 
        class="route-item"
        [class.selected]="isSelected(route.id)"
        [class.focused]="isFocused(route.id)"
        [class.hidden]="!isVisible(route.id)"
        (click)="onRouteClick(route)"
      >
        <!-- Color indicator -->
        <div class="route-color" [style.background-color]="route.color"></div>
        
        <!-- Route info -->
        <div class="route-info">
          <div class="route-name">
            {{ route.name }}
            @if (hasActiveBuses(route.id)) {
              <span class="live-indicator" [title]="getActiveBusCountForRoute(route.id) + ' bus(es) en tr√°nsito'">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                EN VIVO
              </span>
            }
          </div>
          <div class="route-meta">
            <span class="route-id">{{ route.id }}</span>
            <span class="route-points">{{ route.polyline.length }} puntos</span>
            @if (hasActiveBuses(route.id)) {
              <span class="route-buses">
                üöç {{ getActiveBusCountForRoute(route.id) }} activo(s)
              </span>
            }
          </div>
        </div>

        <!-- Actions -->
        <div class="route-actions">
          <button 
            class="visibility-btn"
            [class.visible]="isVisible(route.id)"
            (click)="toggleVisibility($event, route.id)"
            [title]="isVisible(route.id) ? 'Ocultar' : 'Mostrar'"
          >
            @if (isVisible(route.id)) {
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            } @else {
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            }
          </button>
        </div>
      </div>
    }
  </div>

  <!-- Info footer -->
  <div class="route-list-footer">
    @if (selectedCount() > 0) {
      <div class="selection-info">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <span>{{ selectedCount() }} l√≠nea(s) seleccionada(s)</span>
      </div>
    }
  </div>
</div>
